---
import { getCollection, type CollectionEntry } from "astro:content";
import "../styles/fonts.css";
import "../styles/global.css";
import RainbowNotch from "../components/rainbow-notch.astro";
import ProjectCard from "../components/project-card.astro";
import DiscordIcon from "../components/discord-icon.astro";
import type { ProjectCategory } from "../content.config";
import { people } from "../data/people";
import { partners } from "../data/partners";
import metadata from "../../metadata.json";
import { Icon } from "astro-icon/components";

// Fetch and group projects by category
type Project = CollectionEntry<"projects">;
const allProjects = await getCollection("projects");

const categoryOrder: ProjectCategory[] = [
  "Libraries",
  "Templates",
  "Research",
  "Apps",
];

const projectsByCategory: [ProjectCategory, Project[]][] = categoryOrder.map(
  (category) => {
    const items = allProjects
      .filter((p: Project) => p.data.category === category)
      .sort((a: Project, b: Project) => a.data.order - b.data.order);
    return [category, items];
  },
);

// Social links
const socialLinks = [
  { label: "Discord", href: "https://discord.gg/zqmZJmZAQ7" },
  { label: "GitHub", href: "https://github.com/starmode-base" },
  { label: "Bluesky", href: "https://bsky.app/profile/lirbank.com" },
  { label: "Twitter", href: "https://x.com/MikaelLirbank" },
];

const year = new Date().getFullYear();
---

<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <!-- Preload Inter normal (must match src URL in fonts.css @font-face) -->
    <link
      rel="preload"
      href="https://fonts.gstatic.com/s/inter/v20/UcCo3FwrK3iLTcviYwYZ8UA3.woff2"
      as="font"
      crossorigin
    />
    <link rel="icon" type="image/svg+xml" href={metadata.browserIcon} />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>{metadata.name}</title>
    <meta
      name="description"
      content={`${metadata.tagline}. ${metadata.description}`}
    />
    <meta property="og:image" content={metadata.shareCard} />
    <meta name="twitter:card" content="summary_large_image" />
    <script>
      import { configure } from "onedollarstats";

      configure({
        trackLocalhostAs: "www.starmode.dev",
      });
    </script>
  </head>
  <body class="bg-slate-50 text-slate-800 antialiased">
    <!-- Rainbow Notch -->
    <div class="fixed inset-x-0 bottom-0">
      <RainbowNotch href="#inclusion" />
    </div>

    <!-- Header -->
    <header
      class="flex flex-col items-center gap-6 px-6 py-16 text-center sm:py-28"
    >
      <h1 class="sr-only">{metadata.name}</h1>
      <div class="px-8">
        <img
          src="/starmode-logo.svg"
          alt={metadata.name}
          width="728"
          height="74"
          class="h-auto w-full max-w-sm"
        />
      </div>
      <p class="token-hero-tagline">
        {metadata.tagline}
      </p>
      <p class="token-hero-description max-w-sm">
        {metadata.description}
      </p>
    </header>

    <!-- Main -->
    <main>
      <section-group class="pt-0">
        <!-- Projects -->
        <section class="gap-16">
          <h2 class="sr-only">Projects</h2>
          {
            projectsByCategory.map(([category, items]) => (
              <div class="flex flex-col gap-10">
                <h2 class="border-b border-slate-200 pb-2">{category}</h2>
                {items.map((project) => (
                  <ProjectCard project={project} category={category} />
                ))}
              </div>
            ))
          }
        </section>
      </section-group>

      <section-group class="bg-slate-100">
        <section class="items-center gap-6 sm:flex-row sm:justify-between">
          <div class="flex flex-col gap-3 text-center sm:text-left">
            <h2>Join us on Discord</h2>
            <h3 class="token-xl">
              Talk about your projects, collaborate, contribute, and learn
            </h3>
            <p>
              We're friendly folks who love talking about AI, code, design, and
              marketing. Our Discord server is a low-key space for
              brainstorming, asking questions, and connecting with people who
              care about the same things you do.
            </p>
          </div>
          <a
            href="https://discord.gg/zqmZJmZAQ7"
            class="inline-flex shrink-0 items-center gap-3 bg-slate-900 px-8 py-4 font-mono text-sm font-bold tracking-wider text-slate-100 uppercase transition-colors hover:bg-slate-800 hover:text-white"
            style="clip-path: polygon(12px 0, 100% 0, 100% calc(100% - 12px), calc(100% - 12px) 100%, 0 100%, 0 12px);"
          >
            <DiscordIcon class="size-5" />
            <span>Enter Discord</span>
          </a>
        </section>
      </section-group>

      <section-group>
        <!-- What the collective offers -->
        <section class="gap-6">
          <h2>What the collective offers</h2>
          <ul class="flex max-w-2xl flex-col gap-3">
            <li>
              <strong>Bring your own project</strong> — Open source, free apps, commercial
              products. All welcome.
            </li>
            <li>
              <strong>Rendezvous</strong> — 30 min weekly video call on Discord where
              we discuss challenges, share progress, get feedback.
            </li>
            <li>
              <strong>Discord community</strong> — Async collaboration and conversation.
            </li>
            <li>
              <strong>Publish on starmode.dev</strong> — Showcase your projects here.
            </li>
          </ul>
          <p class="max-w-2xl">
            Everything is optional. Open to any builder. Projects belong to
            their authors. STΛR MODΞ is not a company, it is a collective of
            builders helping each other.
          </p>
        </section>
        <!-- Collective -->
        <section class="gap-6">
          <h2>Members</h2>
          <div class="flex flex-wrap gap-10">
            {
              people.map((person) => (
                <a
                  href={person.website || `https://github.com/${person.github}`}
                  class="group flex flex-col items-center gap-3"
                  target="_blank"
                >
                  <img
                    src={`https://github.com/${person.github}.png?size=160`}
                    alt={person.name}
                    width="80"
                    height="80"
                    class="h-20 w-20 rounded-full bg-slate-200 transition-transform group-hover:scale-105"
                  />
                  <h3 class="group-hover:text-cerise transition-colors">
                    {person.name}
                  </h3>
                </a>
              ))
            }
          </div>
          <a
            href="https://github.com/starmode-base/starmode-site/edit/main/src/data/people.ts"
            class="hover:text-cerise flex items-center gap-2 text-sm transition-colors"
            target="_blank"
            title="Edit this list on GitHub"
          >
            <Icon name="ph:pencil-simple-line" class="size-5" /> Add yourself
          </a>
        </section>

        <!-- Inclusion -->
        <section id="inclusion" class="items-start gap-6">
          <RainbowNotch variant="inline" />
          <h2>Inclusion</h2>
          <p class="max-w-2xl">
            Everyone deserves to feel safe, respected, and welcome—everywhere,
            always. That means creating an environment where people can
            contribute openly, ask questions freely, and be themselves. It also
            means calling out discrimination and exclusionary behavior—silence
            isn't neutrality.
          </p>
        </section>

        <!-- Partners -->
        <section class="gap-6">
          <h2>Partners</h2>
          <div class="flex flex-wrap items-center gap-10">
            {
              partners.map((partner) => (
                <a
                  href={partner.url}
                  class="group flex items-center"
                  target="_blank"
                  title={partner.description}
                >
                  <img
                    src={partner.logo}
                    alt={partner.name}
                    height="32"
                    class="h-8 opacity-80 transition-opacity group-hover:opacity-100"
                  />
                </a>
              ))
            }
          </div>
        </section>
      </section-group>
    </main>

    <!-- Footer -->
    <footer>
      <section-group class="bg-slate-100 py-12">
        <section class="justify-between gap-6 sm:flex-row">
          <div class="flex items-center gap-6">
            {
              socialLinks.map(({ label, href }) => (
                <a href={href} class="token-link">
                  {label}
                </a>
              ))
            }
          </div>
          <p>© {year} {metadata.name}</p>
        </section>
      </section-group>
    </footer>
  </body>
</html>
